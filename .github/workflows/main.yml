name: CI Pipeline

on:
  push:
    branches:
      - main
    paths:
      - 'backend/**'
      - '.github/workflows/**'
      - 'docker/docker-compose-server.yaml'
  pull_request:
    branches:
      - main
      - dev
    paths:
      - 'backend/**'
      - '.github/workflows/**'

jobs:
  deploy:
    environment: prod
    uses: ./.github/workflows/deploy.yml
    with:
      scp_source: 'docker/docker-compose-server.yaml'
      scp_target: '/home/ubuntu/docker-compose-server.yaml'
    secrets:
      server_host: ${{ secrets.SERVER_HOST }}
      server_username: ${{ secrets.SERVER_USERNAME }}
      server_password: ${{ secrets.SERVER_PASSWORD }}
      server_port: ${{ secrets.SERVER_PORT }}
